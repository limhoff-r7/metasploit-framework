require 'spec_helper'

describe Msf::Exploit do
  include_context 'Metasploit::Framework::Spec::Constants cleaner'
  include_context 'Msf::Simple::Framework'

  subject(:exploit_instance) do
    framework.modules.create_from_module_class(cache_exploit_instance.module_class)
  end

  #
  # lets
  #

  let(:cache_exploit_class) do
    FactoryGirl.create(
        :mdm_module_class,
        module_type: 'exploit'
    )
  end

  let(:cache_exploit_instance) do
    FactoryGirl.create(
        :mdm_module_instance,
        module_class: cache_exploit_class
    )
  end

  it_should_behave_like 'Msf::Exploit::Payload'

  it_should_behave_like 'Msf::Module::SaveRegisters' do
    let(:metasploit_instance) do
      exploit_instance
    end
  end

  context '#check' do
    subject(:check) do
      exploit_instance.check
    end

    it 'defaults to Msf::Exploit::CheckCode::Unsupported' do
      expect(check).to eq(Msf::Exploit::CheckCode::Unsupported)
    end
  end

  context 'type' do
    subject(:type) do
      described_class.type
    end

    it 'should be Metasploit::Model::Module::Type::EXPLOIT' do
      type.should == Metasploit::Model::Module::Type::EXPLOIT
    end
  end
end